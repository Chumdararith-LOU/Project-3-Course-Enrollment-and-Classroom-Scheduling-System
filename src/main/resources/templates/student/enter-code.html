<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link th:href="@{/css/output.css}" rel="stylesheet" />
    <title>Enter Attendance Code - Student Portal</title>
    <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js"></script>
    <style>
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .fade-in {
        animation: fadeIn 0.6s ease-out forwards;
      }
      .form-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .form-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen flex items-center justify-center">
    <div class="max-w-xl mx-auto p-8">
      <div class="form-card bg-white rounded-2xl shadow-2xl overflow-hidden fade-in">
        <!-- Header -->
        <div class="p-6 border-b border-gray-100 bg-gradient-to-r from-indigo-50 to-blue-50">
          <div class="flex items-center justify-center">
            <div class="bg-indigo-100 rounded-xl p-3 mr-3">
              <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"/>
              </svg>
            </div>
            <div>
              <h2 class="text-2xl font-bold text-gray-800">Enter Attendance Code</h2>
              <p class="text-sm text-gray-600 mt-1">Enter schedule ID and code provided by your lecturer</p>
            </div>
          </div>
        </div>
        
        <!-- Form Content -->
        <div class="p-8">
          <div class="space-y-6">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Schedule ID</label>
              <input
                id="scheduleId"
                class="block w-full rounded-xl border-gray-200 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition-all duration-200 px-4 py-3"
                placeholder="Enter schedule ID"
              />
            </div>
            
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Attendance Code</label>
              <input 
                id="code" 
                class="block w-full rounded-xl border-gray-200 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition-all duration-200 px-4 py-3"
                placeholder="Enter 6-digit code"
                maxlength="6"
              />
            </div>
            
            <div class="flex justify-end">
              <button 
                id="submit" 
                class="inline-flex items-center px-8 py-3 bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-700 text-white font-semibold rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl"
              >
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                Submit Attendance
              </button>
            </div>
          </div>
          
          <!-- Result Display -->
          <div id="result" class="mt-6 p-4 rounded-xl text-center text-sm font-medium"></div>
        </div>
      </div>
    </div>

    <script>
      document
        .getElementById("submit")
        .addEventListener("click", async function () {
          const sid = document.getElementById("scheduleId").value;
          const code = document.getElementById("code").value;
          const resultEl = document.getElementById("result");
          
          if (!sid || !code) {
            resultEl.className = "mt-6 p-4 rounded-xl text-center text-sm font-medium bg-red-50 text-red-700 border border-red-200";
            resultEl.innerText = "Please fill in both schedule ID and attendance code";
            return;
          }
          
          resultEl.className = "mt-6 p-4 rounded-xl text-center text-sm font-medium bg-blue-50 text-blue-700 border border-blue-200";
          resultEl.innerText = "Submitting...";
          
          try {
            const res = await fetch("/api/attendance-code/enter", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ scheduleId: parseInt(sid), code: code }),
            });
            const j = await res.json();
            if (!res.ok) {
              resultEl.className = "mt-6 p-4 rounded-xl text-center text-sm font-medium bg-red-50 text-red-700 border border-red-200";
              resultEl.innerText = "Error: " + (j.error || JSON.stringify(j));
            } else {
              resultEl.className = "mt-6 p-4 rounded-xl text-center text-sm font-medium bg-green-50 text-green-700 border border-green-200";
              resultEl.innerText = "âœ“ " + (j.message || "Attendance recorded successfully!");
              // Clear form after success
              setTimeout(() => {
                document.getElementById("scheduleId").value = "";
                document.getElementById("code").value = "";
              }, 2000);
            }
          } catch (e) {
            resultEl.className = "mt-6 p-4 rounded-xl text-center text-sm font-medium bg-red-50 text-red-700 border border-red-200";
            resultEl.innerText = "Error: " + e;
          }
        });
    </script>
  </body>
</html>
